@page "/register"
@attribute [Microsoft.AspNetCore.Authorization.AllowAnonymous]
@using CSE325_visioncoders.Services
@using CSE325_visioncoders.Models
@inject AuthService Auth
@inject NavigationManager Nav

<div class="titleBar">
    <img class="titleIcon" src="img/registerIcon.svg" alt="register icon">
    <a>Register</a>
</div>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert @messageClass">@message</div>
}

<div class="loginForm">
    
    <label>Name</label>
    <input @bind="name" />

    <label>Email</label>
    <input @bind="email" />

    <label>Phone</label>
    <input @bind="phone" />

    <label>Address</label>
    <input @bind="address" />

    <label>Password</label>
    <input type="password" @bind="password" />

    <label>Confirm Password</label>
    <input type="password" @bind="confirmPassword" />

    <label>Role</label>
    <select @bind="role">
        <option value="customer">Customer</option>
        <option value="cook">Cook</option>
    </select>
    

    <button @onclick="OnRegisterClicked" class="btn-login">Register</button>
</div>

@code {
    private string name = string.Empty;
    private string email = string.Empty;
    private string phone = string.Empty;
    private string address = string.Empty;
    private string password = string.Empty;
    private string confirmPassword = string.Empty;
    private string role = "customer";

    private string message = string.Empty;
    private string messageClass = "alert-danger";

    private async Task OnRegisterClicked()
    {
        message = string.Empty;

        if (password != confirmPassword)
        {
            message = "Passwords do not match.";
            messageClass = "alert-danger";
            return;
        }

        var request = new RegisterRequest
        {
            Name = name,
            Email = email,
            Password = password,
            Role = role,
            Phone = phone,
            Address = address
        };

        var ok = await Auth.RegisterAsync(request);
        if (!ok)
        {
            message = "Registration failed. Email might already be in use.";
            messageClass = "alert-danger";
            return;
        }

        message = "Registration successful! You can now log in.";
        messageClass = "alert-success";

        await Task.Delay(800);
        Nav.NavigateTo("/login");
    }
}
