@page "/orders"
@using System.Linq
@using CSE325_visioncoders.Models
@using CSE325_visioncoders.Services
@inject IOrderService DataService

<div class="titleBar">
    <img class="titleIcon" src="img/orderIcon.svg" alt="order icon">
    <a>Orders</a>
</div>

@if (orders is null)
{
    <p>Loading...</p>
}
else if (orders.Count == 0)
{
    <p>No data</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Email</th>
                <th>Quantity</th>
                <th>Specials</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var o in orders)
            {
                <tr>
                    <td>@o.OrderDate.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@o.Email</td>
                    <td>@o.Quantity</td>
                    <td>@string.Join(", ", (o.Specials ?? new()).Select(kv => $"{kv.Keys.First()}={kv.Values.First()}"))</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<Order>? orders;

    protected override async Task OnInitializedAsync()
    {
        orders = await DataService.GetAsync();
    }
}